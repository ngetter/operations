{% extends "base.html" %}
{% block script %}
<script>
	$('.btn-arrival').click(function(){
		var btn = $(this)
		btn.button('loading');
        
		$.ajax({
			method: 'POST',
			url: 'mark_arrival',
            dataType: 'json',
			data: {id: btn.data('id'), username:'{{user.username}}'}
			})
			.done(function(str){
                $('#length_' +  btn.data('id')).html(str.length);
                btn.button('reset')
                if(str.participate==true) {
                    btn.html('<span class="glyphicon glyphicon-thumbs-up"></span>&nbsp;משתתף');
                    btn.removeClass('btn-primary').addClass('btn-success');
                    $('#' + btn.data('id')).removeClass('warning').addClass('success')
                    }
                else {
                    btn.html('<span class="glyphicon glyphicon-thumbs-down"></span>&nbsp;לא משתתף');
                    btn.removeClass('btn-success').addClass('btn-primary');
                    $('#' + btn.data('id')).removeClass('success').addClass('warning')
                    }
				});

				


	});
    
    $('.modal-list').click(function(){
            $(".modal-content").html("<span>טוען...<span>")
            $.ajax({
                method: 'GET',
                url: $(this).attr('href')
            
            }).done(function(str){$(".modal-content").html(str)});
    });
    
    //$('.addthisevent').popover()
</script>

{% block page_style %}
<style type="text/css">

.addthisevent-drop 						{width:27px;height:23px;display:inline-block;position:relative;z-index:3;font-family:arial;color:#333;text-decoration:none;font-size:14px;text-decoration:none;background:url(/static/img/icon-calendar.png) no-repeat;}
.addthisevent-drop:hover 				{color:#555;font-size:14px;text-decoration:none;}
.addthisevent-selected 					{}
.addthisevent_dropdown 					{width:200px;position:absolute;z-index:3;padding:6px 0px 0px 0px;background:#fff;text-align:left;display:none;margin-top:4px;margin-left:-1px;border-top:1px solid #c8c8c8;border-right:1px solid #bebebe;border-bottom:1px solid #a8a8a8;border-left:1px solid #bebebe;-moz-border-radius:2px;-webkit-border-radius:2px;-webkit-box-shadow:1px 3px 6px rgba(0,0,0,0.15);-moz-box-shadow:1px 3px 6px rgba(0,0,0,0.15);box-shadow:1px 3px 6px rgba(0,0,0,0.15);}
.addthisevent_dropdown span 			{width:175px;display:block;line-height:110%;background:#fff;text-decoration:none;font-size:12px;color:#6d84b4;padding:8px 10px 9px 15px;}
.addthisevent_dropdown span:hover 		{background:#f4f4f4;color:#6d84b4;text-decoration:none;font-size:12px;}
.addthisevent span 						{display:none!important;}
.addthisevent-drop ._url,.addthisevent-drop ._start,.addthisevent-drop ._end,.addthisevent-drop ._summary,.addthisevent-drop ._description,.addthisevent-drop ._location,.addthisevent-drop ._organizer,.addthisevent-drop ._organizer_email,.addthisevent-drop ._facebook_event,.addthisevent-drop ._all_day_event {display:none!important;}
.addthisevent_dropdown .copyx 			{width:200px;height:21px;display:block;position:relative;cursor:default;}
.addthisevent_dropdown .brx 			{width:180px;height:1px;overflow:hidden;background:#e0e0e0;position:absolute;z-index:2;left:10px;top:9px;}
.addthisevent_dropdown .frs 			{position:absolute;top:5px;cursor:pointer;right:10px;padding-left:10px;font-style:normal;font-weight:normal;text-align:right;z-index:3;line-height:110%;background:#fff;text-decoration:none;font-size:9px;color:#cacaca;}
.addthisevent_dropdown .frs:hover 		{color:#6d84b4;}
.addthisevent 							{visibility:hidden;}

</style>

<link rel="stylesheet"  href="{{ url_for('static', filename='css/ios6toggle.css') }}">
{% endblock %}
<!-- AddThisEvent -->
<script type="text/javascript" src="http://js.addthisevent.com/atemay.js"></script>
<!-- AddThisEvent Settings -->
<script type="text/javascript">
addthisevent.settings({
	mouse		: false,
	css			: false,
	outlook		: {show:true, text:"הוסף לאאוטלוק"},
	google		: {show:true, text:"הוסף ליומן גוגל"},
	yahoo		: {show:true, text:"הוסף ליומן יאהו"},
	ical		: {show:false, text:"iCal Calendar"},
	hotmail		: {show:true, text:"הוסף ליומן הוטמייל"},
	facebook	: {show:false, text:"Facebook Calendar"}
});
</script>

{% endblock %}

{% block content %}
<div id="modal" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title">משתתפים בפעולה</h4>
        </div>
      טוען
    </div>
  </div>
</div>
<div class="well">

<h4>פעולות סוף השבוע הקרוב<!--&nbsp;<small>לפעולות קודמות&nbsp;<a href="">לחץ כאן</a></small>--></h4>

<table class='table table-striped table-condensed' >
    {% for k in l[0:2] %}
    {% if k.participate %}
        {% if user.username not in k.participate  %}
            {% set buttonStatus = {'buttonClass':'btn-primary','buttonCaption':'לא משתתף', 'rowClass':'warning', 'glyph':'glyphicon-thumbs-down'} %}
        {% else %}
            {% set buttonStatus = {'buttonClass':'btn-success','buttonCaption':'משתתף', 'rowClass':'success', 'glyph':'glyphicon-thumbs-up'} %}
        {% endif %}
    {% else %}
        {% set buttonStatus = {'buttonClass':'btn-primary','buttonCaption':'לא משתתף', 'rowClass':'warning', 'glyph':'glyphicon-thumbs-down'} %}
    {% endif %}
    
    <tr class='{{ buttonStatus.rowClass }}' id='{{ k._id }}'>
        <td width="20%"><strong>{{ k['date'].strftime('%d.%m') }}</strong><br>{{ k['comment'] }}</td>
        <td class=' hidden-xs ' width='40%'><span>{{ k['instractor'] }}</span><br/><span>{{ k['incharge'] }}</span></td>
        <td><a id="modal_a_{{ k['_id'] }}" class="modal-list" data-toggle="modal" data-target="#modal" href="participants/{{ k['_id'] }}"><strong>משתתפים&nbsp;<span id='length_{{ k._id }}' class="badge badge-primary">{{ k['participate']|length }}</span></a></td>
        <td  ><button type="button" class="btn {{ buttonStatus.buttonClass }} btn-xs btn-arrival" data-id="{{ k['_id'] }}"><span class="glyphicon {{ buttonStatus.glyph }}"></span>&nbsp;{{ buttonStatus.buttonCaption }}</button>

        </td>

    </tr>
    {% endfor %}
</table>
</div>
<div class="page-header">
<h4>פעולות נוספות</h4>
</div>
<table class='table table-striped table-condensed' >
    {% for k in l[2:] %}
    {% if k.participate %}
        {% if user.username not in k.participate  %}
            {% set buttonStatus = {'buttonClass':'btn-primary','buttonCaption':'לא משתתף', 'rowClass':'warning', 'glyph':'glyphicon-thumbs-down'} %}
        {% else %}
            {% set buttonStatus = {'buttonClass':'btn-success','buttonCaption':'משתתף', 'rowClass':'success', 'glyph':'glyphicon-thumbs-up'} %}
        {% endif %}
    {% else %}
        {% set buttonStatus = {'buttonClass':'btn-primary','buttonCaption':'לא משתתף', 'rowClass':'warning', 'glyph':'glyphicon-thumbs-down'} %}
    {% endif %}
    
    <tr class='{{ buttonStatus.rowClass }}' id='{{ k._id }}'>
        <td width="20%"><strong>{{ k['date'].strftime('%d.%m') }}</strong></br>{{ k['comment'] }}</td>
        <td class=' hidden-xs ' >
            <a style="margin-top:8pt;z-order:0;" href="#" title="הוסף ליומן" data-container="body" data-toggle="popover" data-placement="top" 
            data-content="עדכן מועד פעולה ביומן אישי." data-trigger="hover" class="addthisevent">

                <span class="_start">{{ k['date'].strftime('%m-%d-%Y 08:30:00') }}</span>
                <span class="_end">{{ k['date'].strftime('%m-%d-%Y 17:00:00') }}</span>
                <span class="_summary">פעולת דאייה בתימן</span>
                <span class="_description"><span>מדריך:{{ k['instractor'] }}</span><br/><span>אחראי בשדה:{{ k['incharge'] }}</span></span>
                <span class="_zonecode">52</span>
                <span class="_all_day_event">false</span>
                <span class="_date_format">MM/DD/YYYY</span>
            </a> 
        </td>
        <td class=' hidden-xs ' width='40%'><span>{{ k['instractor'] }}</span><br/><span>{{ k['incharge'] }}</span>
        </td>
        <td><a id="modal_a_{{ k['_id'] }}" class="modal-list" data-toggle="modal" data-target="#modal" href="participants/{{ k['_id'] }}"><strong>משתתפים&nbsp;<span id='length_{{ k._id }}' class="badge badge-primary">{{ k['participate']|length }}</span></a></td>
        <td width="20%"><button type="button" class="btn {{ buttonStatus.buttonClass }} btn-xs btn-arrival" data-id="{{ k['_id'] }}"><span class="glyphicon {{ buttonStatus.glyph }}"></span>&nbsp;{{ buttonStatus.buttonCaption }}</button>

        </td>
    </tr>
    {% endfor %}
</table>

{% endblock %}