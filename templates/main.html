{% extends "base.html" %}
{% block script %}
<script>
	$('.btn-arrival').click(function(){
		var btn = $(this)
		btn.button('loading');
		$.ajax({
			method: 'POST',
			url: 'mark_arrival',
			data: {id: btn.data('id'), username:'{{user.username}}'}
			})
			.done(function(str){
                btn.button('reset')
                if(str=='par') {
                    btn.html('<span class="glyphicon glyphicon-thumbs-up"></span>&nbsp;משתתף');
                    btn.removeClass('btn-primary').addClass('btn-success');
                    }
                else {
                    btn.html('<span class="glyphicon glyphicon-thumbs-down"></span>&nbsp;לא משתתף');
                    btn.removeClass('btn-success').addClass('btn-primary');
                    }
				});

				


	});
    
    $('.modal-list').click(function(){
            $(".modal-content").html("<span>טוען...<span>")
            $.ajax({
                method: 'GET',
                url: $(this).attr('href')
            
            }).done(function(str){$(".modal-content").html(str)});
    });
</script>
{% endblock %}

{% block content %}
<div id="modal" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      טוען
    </div>
  </div>
</div>

<div class="table-responsive">
<table class='table table-striped table-condensed' >
    {% for k in l %}
    {% if k.participate %}
        {% if user.username not in k.participate  %}
            {% set buttonStatus = {'buttonClass':'btn-primary','buttonCaption':'לא משתתף', 'rowClass':'warning', 'glyph':'glyphicon-thumbs-down'} %}
        {% else %}
            {% set buttonStatus = {'buttonClass':'btn-success','buttonCaption':'משתתף', 'rowClass':'success', 'glyph':'glyphicon-thumbs-up'} %}
        {% endif %}
    {% else %}
        {% set buttonStatus = {'buttonClass':'btn-primary','buttonCaption':'לא משתתף', 'rowClass':'warning', 'glyph':'glyphicon-thumbs-down'} %}
    {% endif %}
    
    <tr class='{{ buttonStatus.rowClass }}' id='{{ k._id }}'>
        <td width="20%">{{ k['date'].strftime('%d.%m') }}<br>{{ k['comment'] }}</td>
        <td class='hidden-md' width='40%'><span>{{ k['instractor'] }}</span><br/><span>{{ k['incharge'] }}</span></td>
        <td><a id="modal_a_{{ k['_id'] }}" class="modal-list" data-toggle="modal" data-target="#modal" href="participants/{{ k['_id'] }}"><strong>משתתפים&nbsp;<span class="badge badge-primary">{{ k['participate']|length }}</span></a></td>
        <td width="20%"><button type="button" class="btn {{ buttonStatus.buttonClass }} btn-xs btn-arrival" data-id="{{ k['_id'] }}"><span class="glyphicon {{ buttonStatus.glyph }}"></span>&nbsp;{{ buttonStatus.buttonCaption }}</button></td>
    </tr>
    {% endfor %}
</table>
</div>
{% endblock %}